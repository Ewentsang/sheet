#!/usr/bin/env python3
"""
æµ‹è¯•ç¾è§‚Excelç”Ÿæˆæ•ˆæœ
"""

import requests
import json

def test_beautiful_excel():
    """æµ‹è¯•ç¾è§‚Excelç”Ÿæˆ"""
    print("=== æµ‹è¯•ç¾è§‚Excelç”Ÿæˆ ===")
    
    # æµ‹è¯•æ•°æ®ï¼šåŒ…å«ä¸­è‹±æ–‡æ··åˆï¼Œé•¿æ–‡æœ¬ç­‰
    test_data = {
        "å‘˜å·¥ä¿¡æ¯è¡¨": [
            {
                "å‘˜å·¥ç¼–å·": "EMP001", 
                "å§“å": "å¼ ä¸‰", 
                "éƒ¨é—¨": "æŠ€æœ¯å¼€å‘éƒ¨", 
                "èŒä½": "é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆ", 
                "å…¥èŒæ—¥æœŸ": "2023-01-15",
                "è–ªèµ„": 15000,
                "å¤‡æ³¨": "è´Ÿè´£åç«¯å¼€å‘ï¼ŒæŠ€æœ¯èƒ½åŠ›å¼ºï¼Œå›¢é˜Ÿåä½œè‰¯å¥½"
            },
            {
                "å‘˜å·¥ç¼–å·": "EMP002", 
                "å§“å": "æå››", 
                "éƒ¨é—¨": "äº§å“è®¾è®¡éƒ¨", 
                "èŒä½": "UI/UXè®¾è®¡å¸ˆ", 
                "å…¥èŒæ—¥æœŸ": "2023-03-20",
                "è–ªèµ„": 12000,
                "å¤‡æ³¨": "æ“…é•¿ç”¨æˆ·ç•Œé¢è®¾è®¡ï¼Œæœ‰ä¸°å¯Œçš„ç§»åŠ¨ç«¯è®¾è®¡ç»éªŒ"
            },
            {
                "å‘˜å·¥ç¼–å·": "EMP003", 
                "å§“å": "ç‹äº”", 
                "éƒ¨é—¨": "å¸‚åœºè¥é”€éƒ¨", 
                "èŒä½": "å¸‚åœºæ¨å¹¿ä¸“å‘˜", 
                "å…¥èŒæ—¥æœŸ": "2023-06-10",
                "è–ªèµ„": 8000,
                "å¤‡æ³¨": "è´Ÿè´£çº¿ä¸Šæ¨å¹¿æ´»åŠ¨ç­–åˆ’ï¼Œç†Ÿæ‚‰ç¤¾äº¤åª’ä½“è¥é”€"
            },
            {
                "å‘˜å·¥ç¼–å·": "EMP004", 
                "å§“å": "èµµå…­", 
                "éƒ¨é—¨": "äººåŠ›èµ„æºéƒ¨", 
                "èŒä½": "HRä¸“å‘˜", 
                "å…¥èŒæ—¥æœŸ": "2023-02-28",
                "è–ªèµ„": 9000,
                "å¤‡æ³¨": "è´Ÿè´£æ‹›è˜å’Œå‘˜å·¥å…³ç³»ç®¡ç†ï¼Œæ²Ÿé€šèƒ½åŠ›å¼º"
            },
            {
                "å‘˜å·¥ç¼–å·": "EMP005", 
                "å§“å": "å­™ä¸ƒ", 
                "éƒ¨é—¨": "è´¢åŠ¡éƒ¨", 
                "èŒä½": "ä¼šè®¡", 
                "å…¥èŒæ—¥æœŸ": "2023-04-15",
                "è–ªèµ„": 10000,
                "å¤‡æ³¨": "è´Ÿè´£å…¬å¸è´¢åŠ¡æ ¸ç®—å’ŒæŠ¥è¡¨ç¼–åˆ¶ï¼Œå·¥ä½œç»†è‡´è®¤çœŸ"
            }
        ],
        "é”€å”®æ•°æ®": [
            {
                "æœˆä»½": "2024å¹´1æœˆ",
                "äº§å“åç§°": "æ™ºèƒ½æ‰‹æœº",
                "é”€å”®æ•°é‡": 1500,
                "å•ä»·": 2999,
                "æ€»é”€å”®é¢": 4498500,
                "åˆ©æ¶¦ç‡": "25%",
                "é”€å”®åŒºåŸŸ": "åä¸œåœ°åŒº",
                "å¤‡æ³¨": "æ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨æ•ˆæœæ˜¾è‘—ï¼Œé”€é‡è¶…å‡ºé¢„æœŸ"
            },
            {
                "æœˆä»½": "2024å¹´2æœˆ",
                "äº§å“åç§°": "ç¬”è®°æœ¬ç”µè„‘",
                "é”€å”®æ•°é‡": 800,
                "å•ä»·": 5999,
                "æ€»é”€å”®é¢": 4799200,
                "åˆ©æ¶¦ç‡": "30%",
                "é”€å”®åŒºåŸŸ": "åå—åœ°åŒº",
                "å¤‡æ³¨": "å•†åŠ¡å®¢æˆ·é‡‡è´­å¢åŠ ï¼Œä¼ä¸šè®¢å•å æ¯”æå‡"
            },
            {
                "æœˆä»½": "2024å¹´3æœˆ",
                "äº§å“åç§°": "å¹³æ¿ç”µè„‘",
                "é”€å”®æ•°é‡": 1200,
                "å•ä»·": 1999,
                "æ€»é”€å”®é¢": 2398800,
                "åˆ©æ¶¦ç‡": "20%",
                "é”€å”®åŒºåŸŸ": "ååŒ—åœ°åŒº",
                "å¤‡æ³¨": "æ•™è‚²è¡Œä¸šé‡‡è´­éœ€æ±‚å¢é•¿ï¼Œå­¦ç”Ÿç¾¤ä½“è´­ä¹°åŠ›å¢å¼º"
            }
        ],
        "é¡¹ç›®è¿›åº¦": [
            {
                "é¡¹ç›®åç§°": "ç”µå•†å¹³å°é‡æ„é¡¹ç›®",
                "é¡¹ç›®ç»ç†": "å¼ ä¸‰",
                "å¼€å§‹æ—¥æœŸ": "2024-01-01",
                "é¢„è®¡å®Œæˆ": "2024-06-30",
                "å½“å‰è¿›åº¦": "60%",
                "çŠ¶æ€": "è¿›è¡Œä¸­",
                "å›¢é˜Ÿæˆå‘˜": "8äºº",
                "é¡¹ç›®æè¿°": "å¯¹ç°æœ‰ç”µå•†å¹³å°è¿›è¡ŒæŠ€æœ¯æ¶æ„å‡çº§ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ"
            },
            {
                "é¡¹ç›®åç§°": "ç§»åŠ¨APPå¼€å‘",
                "é¡¹ç›®ç»ç†": "æå››",
                "å¼€å§‹æ—¥æœŸ": "2024-02-15",
                "é¢„è®¡å®Œæˆ": "2024-08-15",
                "å½“å‰è¿›åº¦": "30%",
                "çŠ¶æ€": "è¿›è¡Œä¸­",
                "å›¢é˜Ÿæˆå‘˜": "6äºº",
                "é¡¹ç›®æè¿°": "å¼€å‘å…¬å¸å®˜æ–¹ç§»åŠ¨åº”ç”¨ï¼Œæ”¯æŒiOSå’ŒAndroidåŒå¹³å°"
            }
        ]
    }
    
    try:
        print("ğŸ“¤ å‘é€è¯·æ±‚ç”Ÿæˆç¾è§‚Excel...")
        response = requests.post(
            "http://localhost:5000/make-xlsx-bytes",
            json=test_data,
            headers={"Content-Type": "application/json"},
            timeout=30
        )
        
        print(f"ğŸ“Š å“åº”çŠ¶æ€ç : {response.status_code}")
        
        if response.status_code == 200:
            # ä¿å­˜æ–‡ä»¶
            filename = "beautiful_excel_demo.xlsx"
            with open(filename, "wb") as f:
                f.write(response.content)
            
            print("âœ… ç¾è§‚Excelç”ŸæˆæˆåŠŸï¼")
            print(f"ğŸ“ æ–‡ä»¶å·²ä¿å­˜ä¸º: {filename}")
            print(f"ğŸ“ æ–‡ä»¶å¤§å°: {len(response.content)} å­—èŠ‚")
            print(f"ğŸ“‹ Content-Type: {response.headers.get('content-type')}")
            
            print("\nğŸ¨ ç¾è§‚æ•ˆæœåŒ…æ‹¬:")
            print("   â€¢ è¡¨å¤´ï¼šæ·±è“åº• + ç™½å­— + åŠ ç²—ï¼Œè¡Œé«˜22")
            print("   â€¢ æ–‘é©¬æ¡çº¹ï¼šå†…å®¹åŒºéš”è¡Œåº•è‰²")
            print("   â€¢ è¾¹æ¡†ä¸å¯¹é½ï¼šç»†è¾¹æ¡† + å‚ç›´å±…ä¸­ï¼Œæ–‡æœ¬è‡ªåŠ¨æ¢è¡Œ")
            print("   â€¢ æ™ºèƒ½åˆ—å®½ï¼šæ ¹æ®ä¸­è‹±æ–‡å®½åº¦ä¼°ç®—ï¼Œ8-40å­—ç¬¦èŒƒå›´")
            
            return True
        else:
            print(f"âŒ è¯·æ±‚å¤±è´¥: {response.status_code}")
            print(f"ğŸ“ é”™è¯¯ä¿¡æ¯: {response.text}")
            return False
            
    except Exception as e:
        print(f"âŒ é”™è¯¯: {e}")
        return False

def test_simple_data():
    """æµ‹è¯•ç®€å•æ•°æ®çš„ç¾è§‚æ•ˆæœ"""
    print("\n=== æµ‹è¯•ç®€å•æ•°æ®ç¾è§‚æ•ˆæœ ===")
    
    simple_data = {
        "åŸºæœ¬ä¿¡æ¯": {
            "å…¬å¸åç§°": "ç¤ºä¾‹ç§‘æŠ€æœ‰é™å…¬å¸",
            "æˆç«‹æ—¶é—´": "2020å¹´1æœˆ",
            "æ³¨å†Œèµ„æœ¬": "1000ä¸‡å…ƒ",
            "å‘˜å·¥äººæ•°": "150äºº",
            "ä¸»è¥ä¸šåŠ¡": "è½¯ä»¶å¼€å‘ã€æŠ€æœ¯å’¨è¯¢ã€ç³»ç»Ÿé›†æˆ",
            "å…¬å¸åœ°å€": "åŒ—äº¬å¸‚æœé˜³åŒºç§‘æŠ€å›­åŒºåˆ›æ–°å¤§å¦Aåº§1001å®¤",
            "è”ç³»ç”µè¯": "010-12345678",
            "å®˜æ–¹ç½‘ç«™": "https://www.example.com"
        }
    }
    
    try:
        print("ğŸ“¤ å‘é€ç®€å•æ•°æ®è¯·æ±‚...")
        response = requests.post(
            "http://localhost:5000/make-xlsx-bytes",
            json=simple_data,
            headers={"Content-Type": "application/json"},
            timeout=30
        )
        
        if response.status_code == 200:
            filename = "simple_beautiful_demo.xlsx"
            with open(filename, "wb") as f:
                f.write(response.content)
            
            print("âœ… ç®€å•æ•°æ®ç¾è§‚Excelç”ŸæˆæˆåŠŸï¼")
            print(f"ğŸ“ æ–‡ä»¶å·²ä¿å­˜ä¸º: {filename}")
            return True
        else:
            print(f"âŒ ç®€å•æ•°æ®æµ‹è¯•å¤±è´¥: {response.status_code}")
            return False
            
    except Exception as e:
        print(f"âŒ ç®€å•æ•°æ®æµ‹è¯•é”™è¯¯: {e}")
        return False

def main():
    """ä¸»å‡½æ•°"""
    print("ğŸ¨ ç¾è§‚Excelç”Ÿæˆæµ‹è¯•")
    print("=" * 50)
    
    # æ£€æŸ¥æœåŠ¡çŠ¶æ€
    try:
        response = requests.get("http://localhost:5000/health")
        if response.status_code == 200:
            print("âœ… æœåŠ¡è¿è¡Œæ­£å¸¸")
        else:
            print("âŒ æœåŠ¡å¼‚å¸¸ï¼Œè¯·å…ˆå¯åŠ¨æœåŠ¡")
            return
    except Exception as e:
        print(f"âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡: {e}")
        print("ğŸ’¡ è¯·å…ˆè¿è¡Œ: python app.py")
        return
    
    # è¿è¡Œæµ‹è¯•
    test_beautiful_excel()
    test_simple_data()
    
    print("\nğŸ‰ æµ‹è¯•å®Œæˆï¼")
    print("\nğŸ’¡ è¯·æ‰“å¼€ç”Ÿæˆçš„Excelæ–‡ä»¶æŸ¥çœ‹ç¾è§‚æ•ˆæœ:")
    print("   â€¢ beautiful_excel_demo.xlsx - å¤æ‚æ•°æ®ç¤ºä¾‹")
    print("   â€¢ simple_beautiful_demo.xlsx - ç®€å•æ•°æ®ç¤ºä¾‹")

if __name__ == "__main__":
    main()

