# 文件复制功能说明

## 功能描述

新增了一个文件复制功能，可以输入一个源文件路径和新文件名，输出一个复制并重命名后的文件。

## 新增的函数

### `copy_file_with_new_name(source_file_path, new_filename)`

**功能**: 复制文件并重命名

**参数**:
- `source_file_path` (str): 源文件的完整路径
- `new_filename` (str): 新文件的名称

**返回值**:
- `str`: 新文件的完整路径

**异常**:
- `FileNotFoundError`: 源文件不存在
- `Exception`: 复制过程中发生错误

**特性**:
- 自动检查源文件是否存在
- 如果目标文件已存在，会先删除再复制
- 保留原文件的所有属性和内容
- 使用 `shutil.copy2()` 确保完整复制

## 新增的API端点

### `POST /copy-file`

**功能**: 通过HTTP API复制文件并重命名

**请求方式**: POST

**请求参数** (JSON格式):
```json
{
    "source_file_path": "源文件路径",
    "new_filename": "新文件名"
}
```

**响应格式**:
```json
{
    "success": true,
    "message": "文件复制成功",
    "source_file": "源文件路径",
    "new_file": "新文件完整路径",
    "new_filename": "新文件名"
}
```

**错误响应**:
```json
{
    "error": "错误信息"
}
```

## 使用示例

### 1. 直接调用函数

```python
from app import copy_file_with_new_name

# 复制文件
new_path = copy_file_with_new_name("original.xlsx", "copy.xlsx")
print(f"新文件路径: {new_path}")
```

### 2. 通过HTTP API调用

```bash
curl -X POST http://localhost:5000/copy-file \
  -H "Content-Type: application/json" \
  -d '{
    "source_file_path": "beautiful_excel_demo.xlsx",
    "new_filename": "my_copy.xlsx"
  }'
```

### 3. 使用Python requests

```python
import requests

response = requests.post(
    "http://localhost:5000/copy-file",
    json={
        "source_file_path": "beautiful_excel_demo.xlsx",
        "new_filename": "my_copy.xlsx"
    }
)

result = response.json()
if result["success"]:
    print(f"复制成功: {result['new_file']}")
else:
    print(f"复制失败: {result['error']}")
```

## 测试

运行测试脚本:
```bash
python test_copy_file.py
```

这个测试脚本会:
1. 直接测试函数调用
2. 测试HTTP API调用
3. 验证文件是否成功复制

## 注意事项

1. 源文件必须存在，否则会抛出 `FileNotFoundError`
2. 新文件名只需要提供文件名，不需要完整路径
3. 新文件会保存在源文件相同的目录下
4. 如果目标文件已存在，会被覆盖
5. 复制过程会保留原文件的所有属性和内容

